name: Rotina do App (Notícias + Lembretes)

on:
  schedule:
    # Roda a cada 6 horas (para pegar notícias frescas)
    - cron: '0 */6 * * *'
  workflow_dispatch: # Permite rodar manualmente

jobs:
  rotina-geral:
    runs-on: ubuntu-latest

    steps:
    - name: Baixar código
      uses: actions/checkout@v3

    - name: Instalar Node.js
      uses: actions/setup-node@v3
      with:
        node-version: 18

    - name: Instalar Dependências
      # Adicionamos rss-parser aqui
      run: npm install firebase-admin rss-parser

    - name: 1. Rodar Buscador de Notícias
      env:
        FIREBASE_SERVICE_ACCOUNT: ${{ secrets.FIREBASE_SERVICE_ACCOUNT }}
      run: node scripts/news-scraper.js

    - name: 2. Rodar Lembretes de Tarefas
      env:
        FIREBASE_SERVICE_ACCOUNT: ${{ secrets.FIREBASE_SERVICE_ACCOUNT }}
      run: node scripts/daily-checks.js