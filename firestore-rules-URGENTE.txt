rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Regras TEMPORÁRIAS para debugging - APLICAR NO CONSOLE DO FIREBASE
    
    // ===== REGRAS PARA USUÁRIOS =====
    match /users/{userId} {
      // Usuário pode ler/escrever seus próprios dados
      allow read, write: if request.auth != null && request.auth.uid == userId;
      
      // Admins podem ler todos os usuários
      allow read: if request.auth != null && 
                 exists(/databases/$(database)/documents/users/$(request.auth.uid)) &&
                 get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }
    
    // ===== REGRAS PARA TAREFAS (SIMPLIFIED) =====
    match /tasks/{taskId} {
      // QUALQUER usuário autenticado pode ler/escrever tarefas
      // (Você pode restringir isso depois se necessário)
      allow read, write: if request.auth != null;
    }
    
    // ===== REGRAS PARA LOGS DE ADMIN =====
    match /admin_logs/{logId} {
      allow read, write: if request.auth != null && 
                        exists(/databases/$(database)/documents/users/$(request.auth.uid)) &&
                        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }
    
    // ===== REGRA DE FALLBACK =====
    // Para qualquer outra coleção, permitir acesso autenticado
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}

/*
INSTRUÇÕES URGENTES:

1. COPIE TODO O CONTEÚDO ACIMA
2. Vá para: https://console.firebase.google.com/
3. Selecione seu projeto: atmv117
4. Menu lateral: Firestore Database
5. Aba: Rules (Regras)
6. SUBSTITUA todo o conteúdo pela regra acima
7. Clique em: Publish (Publicar)
8. Aguarde 2-3 minutos para propagar

Se ainda der erro após isso, as regras podem estar mais restritivas.
Podemos temporariamente usar regras de teste (menos seguro):

// REGRAS DE TESTE (SÓ PARA DEBUG)
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}
*/
